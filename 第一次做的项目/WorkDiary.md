```{=org}
#+STARTUP: overview indent
```
# 2023-07-28

## Diary

1.  学习了一会 pywebio 包和一些自带函数的用法，加强 SQL 构建视图的操作
2.  开发新增逻辑完成任务（可能还有缺陷）待梁哥检查

## Review & TODOs
[]{#0728todos}

1.  [x] 代码没有格式化
1.  [x] 数据库读写不要用底层接口
2.  [x] sha256 可以重用，就不要重复写
3.  [x] 配置与逻辑要分离
4.  [x] 测试数据目录放在项目目录里面

# 2023-07-29

## Diary

### 关于代码格式化

1.  缩进和对齐
2.  代码行间距
3.  空行和空格
4.  命名的规范
5.  注释的规范

### 数据库读写不要用底层接口：

直接使用最底层的 SQL 命令可能会导致数据库的破坏或者是造成严重影响。（重中之重）

1.  不使用底层接口的好处：
    1.  代码可读性和可维护性
    2.  数据库无关性：如果使用的是 ORM，只需要更改配置，不会对数据库造成影响。
    3.  安全性
    4.  易于迁移和版本控制

### 新学知识点：

SQLAlchemy 包 SQLAlchemy 是一个 Python 的开源 ORM（Object-Relational
Mapping）库，它提供了强大的数据库操作功能，使得在 Python 中操作关系型数
据库变得更加简单和灵活。

### 困难

1.  对新包使用不流畅
2.  对代码分离是，相互间调用出现错乱的问题。
3.  对于配置与逻辑分离的操作思考时间过长，缺乏正式项目开发的经验与能力。
4.  不知道如何把图片保存地址修改为项目目录，对 git 不够熟练

## Review & TODOs

upphoto 项目

1.  [x] models.py 似乎改变了字段类型，另外，你不是已经在学 django 吗？

    to keng: 经过查阅 sqlalchemy 并不会修改已存在的表的结构

2.  [x] upload.py

    1.  [x] process~image~ 函数改名为 to~sha256~
    2.  [x] 同名文件名未处理
    3.  [x] 图片的处理定义一个小函数 (img -\> bool)，再遍历。

3.  [x] python 用 black 格式化

4.  [x] [处理 28 日未完成的事宜](#0728todos)

# 2023-07-31

## django 开发过程

1.  创建项目和 app
2.  在 Django 应用中定义了一个名为 WhirMedicine 的模型
3.  在 Django 项目的 settings.py 中配置了 DATABASES 和 MEDIA~ROOT~（保存路径）
4.  forms.py 文件定义了两个表单类，一个用于上传图片，一个用于更新 WhirMedicine 模型
5.  编写项目 urls.py（写入 app 的路由）和 app 的 urls.py（写入具体文件的路由）
6.  编写 views.py
7.  创建模板：upload~images~.html (用于上传) result.html 用于跳转上传结果

## 遇到的问题

1.  views.py 只有上传和结果跳转，缺乏 login 登陆的功能。
2.  views.py 中 def upload_image 函数中编写的逻辑判定，不生效，写入数据库的数据格式有问题。（还在研究，晚上洗完澡继续研究该如何生效判定）

## Review & TODOs


1.  [x] 插入一条记录，查了两次库，需要优化
    to keng: 暂时没想到什么好方法插入一条记录，查一次库
    to keng:已优化，但逻辑上又出现了问题，已记入笔记，等空闲时再思考逻辑的问题，再完善代码提交
    to keng:在update_db函数中一次查库，在upload_images函数中，将优化pload_images函数代码结构，在第一次查库的时候把数据都查下来，后面使用可以减少一次查库。
2.  [x] 查库不要一条一条查
    to keng: 一次性读取了所有的药品信息，并存储到了一个字典和一个集合中。但是这个情况数据是静态的，当上传同名文件的时候会出现信息跟不上。如果梁哥有更好的办法，可以给我提供一个思路。
    to fa: 以上两点都是数据库基础知识，复习一下 SQL 基础语句
    to keng:创建了一个字典，将所有图片的名称、SHA256值和内容保存起来。接下来，我进行了一次查询，查找所有具有这些SHA256值的记录。就不需要一条一条去查了。
3.  [x] models.py 改用 django
    to keng: 在 django 以外用 django 不太合适，现在掌握的方法不足以完成。
    to fa: 再想想。
    to keng:通过这个方法   
    __os.environ.setdefault("DJANGO_SETTINGS_MODULE", "your_project.settings")__可以在外部使用，但是有个前提，Django 项目和当前运行的脚本要在同一环境下运行，会用是会用了，但是现在这样的话就复杂化了，我周六周天再研究研究。
4.  [x] 相同的事情放在一起处理，如 to-sha256
    to keng:已将to_sha256()与process_image合并。代码已测试，没有问题。
4.  [x] 熟悉 markdown 语法
    to keng:已作笔记，抽空时会多背多记。

# 2023-08-01

## 工作

1.  上午处理任务，与苏城沟通逻辑
2.  下午因为暂无思路，所以继续优化之前的代码，然后开始开发适合企业端的上传。
3.  晚上继续完成企业端上传功能的开发

## 遇到的问题
1.  不知道怎么关联 whir_medicine 表和 whir_qy_medicine 表，找不到合适的外键。
    to fa: 已讨论
2.  自己编写的代码优化能力不足，无法精简

## Review & TODOs

1.  [ ] 复习数据库基础知识
    to keng:经过学习，将图片处理和数据库更新步骤合并在一起，并返回了处理结果和更新或插入的记录。优化了代码，但仍需要再多学习学习
2.  [x] 梳理业务流程
    to keng:已经跟城哥沟通交流过了。
3.  [x] 处理好苏城的需求
    to keng:已沟通处理
4.  [x] [处理好 07-31 未完成的工作](#0731todos)   
    to keng:已处理

# 2023-08-02

## 工作

1.  上午编写适合企业端的上传，并做过简单的厕所，push给了梁哥。  
  
2.  下午根据markdown里面的任务，对平台上传功能进行完善，并且大致学习了markdown的语法，做好了笔记，对数据库的基础知识做了大致的回顾。并且跟城哥沟通了业务逻辑

## 遇到的问题
1.  在优化插入一条记录，查了两次库这个问题时，存在逻辑上的修改，暂时还没想明白。但已有大概的思路

2.  把数据库的基础知识运用到实际变换能力不太行，有时候没办法真正理解SQL命令需要加强


# 2023-08-03

## 工作

1.  上午一边完成markdown里面未完成的人物（平台上传表的优化问题），一边等待企业上传功能细节逻辑更改。

2.  下午完成了7月31日当天所有的任务，并且进行简单的代码测试，学会了使用    pyinstaller工具来封装代码，有两种方式：
	**pyinstaller XX.py（主程序文件名）**
	**pyinstaller --onefile XX.py**
	第一种是分散的文件，第二种在dict目录下，只有一个可执行文件。
	注意：在什么系统下进行封装就只能在什么系统下运行。

## 代码问题：
1. 数据库操作需要整合
    WhirQyMedicine，WhirMedicine，WhirQyArchives 3个表都只需要查1次WhirQyMedicine写1次，更新 1次(如需要)
   to keng:使用字典的方式，减少查库。
2. 没有考虑到数据库操作的回退问题
   to keng:使用session.rollback()函数添加回滚
3. symptom 只用了 WhirMedicine 中的值，没有用 Excel 中的值Excel表和图片的关系没有处理
   to keng:和城哥沟通过了，sympton中只从whir_medicine表导入，因为通用药品的症候和xlsx文件中的症候是一样的
4. Excel表和图片的关系没有处理
   to keng:这个暂时还没有想明白，我觉得这个没有多大关系，如果不要症候的话，xlsx都可以不需要了，只需要图片名称对应上药品名即可
5. 不同企业间，图片同名的问题未考虑
   to keng:不同的企业间，同名图片命名为，文件名_qy_id.jpg，这样不会出现重复，如果有企业重复了，那么会覆盖。
6. 单纯记录成功/失败的数量意义不大
   to keng:这个是前期我用来测试用的，可有可无，不影响使用，但是还是保留，因为这也是一种交互方法。
7. equipment_id未处理
   to keng:equipment_id字段从 whir_equipment表导入到whir_qy_medicine表中。并且把whir_equipment表中同一个qy_id对应的多个equipment_id放在一起，用逗号隔开，插入到whir_qy_medicine表中
